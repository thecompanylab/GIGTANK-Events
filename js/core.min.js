function formatTime(date){var output=[];return output.push(date.getHours()%12||12),output.push(":"),output.push(("0"+date.getMinutes()).slice(-2)),output.push(date.getHours()>11?" p.m.":" a.m."),output.join("")}function autolink(text){return text.replace(/((http|https|ftp):\/\/[\w?=&.\/-;#~%-]+(?![\w\s?&.\/;#~%"=-]*>))/g,"<a href='$1'>$1</a>")}function loadBlasts(){var blastsRaw=JSON.parse(httpGet("http://gtc.colab.co/ccbme")).blasts,i=blastsRaw.length;for(blasts=[],days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];i--;){var blastRaw=blastsRaw[i],sent=new Date(blastRaw.created_at),blast={};blastRaw.id>32&&(blast.timestamp=sent.getTime(),blast.time=formatTime(sent),blast.month=months[sent.getMonth()],blast.date=sent.getDate(),blast.day=days[sent.getDay()],blast.id=blastRaw.id,blast.body=blastRaw.body,blast.html=autolink(blastRaw.body),blasts.unshift(blast))}return blasts}function displayBlasts(){var tmpl=document.getElementById("template").innerHTML,blastCon=document.getElementById("blasts");templatedata={blasts:loadBlasts()},blastCon.innerHTML=window.Mustache.render(tmpl,templatedata)}function httpGet(theUrl){var xmlHttp=null;return xmlHttp=new XMLHttpRequest,xmlHttp.open("GET",theUrl,!1),xmlHttp.send(null),xmlHttp.responseText}function setupContacts(group,url){document.addEventListener("DOMContentLoaded",function(){var textContent=httpGet(url),tmpl=document.getElementById("template").innerHTML,data={},ment=document.getElementById("mentors");data[group]=JSON.parse(textContent),ment.innerHTML=window.Mustache.render(tmpl,data)},!1)}function setupMentors(){setupContacts("mentors","/gt14lm")}function setupTechMentors(){setupContacts("mentors","gt15/techmentors")}function setupStaff(){setupContacts("staff","/gt14st")}function setupSpecialist(){setupContacts("staff","/gt14sp")}function setupTeams(){setupContacts("teams","/gt14tm")}function drawBikeStation(station){if("Not In Service"!==station.statusValue){var color="#0b497d",title="Station #"+station.id+", "+station.stationName+" Bikes: "+station.availableBikes+" Slots: "+station.availableDocks,symbol={path:window.bikeIcon,scale:.1,rotation:0,fillColor:color,fillOpacity:0,strokeColor:color,strokeWeight:1.5,anchor:new google.maps.Point(300,670)};0===station.availableBikes||0===station.availableDocks?symbol.strokeColor="#8A1E1A":(station.availableBikes<2||station.availableDocks<2)&&(symbol.strokeColor="#C0C908");var bikeLocation=new google.maps.LatLng(station.latitude,station.longitude),options={position:bikeLocation,title:title,icon:symbol,map:map,properties:station},dataWindow=new google.maps.InfoWindow({content:title,position:options.position});window.bikeMarkers.hasOwnProperty(station.id)?window.bikeMarkers[station.id].setOptions(options):window.bikeMarkers[station.id]=new google.maps.Marker(options),google.maps.event.addListener(window.bikeMarkers[station.id],"click",function(){dataWindow.open(map)})}}function drawBus(bus){if("U"!=bus.properties.route){var color="#000000",headings={N:0,NNE:22.5,NE:45,ENE:67.5,E:90,ESE:112.5,SE:135,SSE:157.5,S:180,SSW:202.5,SW:225,WSW:247.5,W:270,WNW:292.5,NW:315,NNW:337.5};("33"==bus.properties.route||"34"==bus.properties.route)&&(color="#029f5b");var symbol={path:google.maps.SymbolPath.FORWARD_CLOSED_ARROW,scale:3,rotation:heading,fillColor:color,strokeColor:color};buslocation=new google.maps.LatLng(bus.geometry.coordinates[1],bus.geometry.coordinates[0]);var heading=headings[bus.properties.heading];if(window.buses[bus.id]){window.buses[bus.id].setPosition(buslocation);var iconUpdate=window.buses[bus.id].getIcon();iconUpdate.rotation=heading,window.buses[bus.id].setIcon(iconUpdate)}else window.buses[bus.id]=new google.maps.Marker({position:buslocation,title:"Bus #"+bus.id+", Route #"+bus.properties.route,icon:symbol,map:map,properties:bus.properties}),google.maps.event.addListener(window.buses[bus.id],"click",function(){var dataWindow=new google.maps.InfoWindow({content:"Bus #"+bus.id+", Route #"+bus.properties.route+", Towards: "+bus.properties.stop,position:window.buses[bus.id].position});dataWindow.open(map)})}}function killBus(bus){window.buses[bus.id]&&(window.buses[bus.id].setMap(null),window.buses[bus.id]=null,delete window.buses[bus.id])}function setCurrentLocation(){navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(pos){var me=new google.maps.LatLng(pos.coords.latitude,pos.coords.longitude);window.myloc?window.myloc.setPosition(me):window.myloc=new google.maps.Marker({clickable:!1,icon:new google.maps.MarkerImage("//maps.gstatic.com/mapfiles/mobile/mobileimgs2.png",new google.maps.Size(22,22),new google.maps.Point(0,18),new google.maps.Point(11,11)),shadow:null,zIndex:999,map:window.map})},function(){})}function reset(map){console.log("reset");var keys=[];for(var k in window.buses)keys.push(k);for(var i=keys.length;i--;)window.buses[keys[i]].setMap(null),window.buses[keys[i]]=null,delete window.buses[keys[i]];chabusInitialize(map)}function chabikeInitialize(){var evntSource=new EventSource("http://radiant-caverns-5667.herokuapp.com/api/stations/stream");window.bikeMarkers={},xmlHttp=new XMLHttpRequest,xmlHttp.open("GET","http://radiant-caverns-5667.herokuapp.com/api/stations",!1),xmlHttp.send();var responseObject=JSON.parse(xmlHttp.responseText);window.citybikes=JSON.parse(responseObject).stationBeanList;for(var j=window.citybikes.length;j--;)drawBikeStation(window.citybikes[j]);evntSource.onmessage=function(x){for(var json=JSON.parse(x.data).stationBeanList,j=json.length;j--;)drawBikeStation(json[j])}}function chabusInitialize(map){var evntSource=new EventSource("http://api.chab.us/buses/tail");window.buses={},xmlHttp=new XMLHttpRequest,xmlHttp.open("GET","http://api.chab.us/buses",!1),xmlHttp.send();for(var initialbuses=JSON.parse(xmlHttp.responseText).features,i=initialbuses.length;i--;)"U"!=initialbuses[i].properties.route&&drawBus(initialbuses[i]);setCurrentLocation(),evntSource.addEventListener("change",function(x){var json=JSON.parse(x.data);drawBus(json),setCurrentLocation()}),evntSource.addEventListener("remove",function(x){var json=JSON.parse(x.data);killBus(json)}),google.maps.event.addListenerOnce(map,"idle",function(){document.querySelector("#footer-grab").style.bottom=document.querySelector(".gm-style-cc").clientHeight.toString()+"px",console.log(document.querySelector(".gm-style-cc").clientHeight)}),window.onresize=resizeScreen}function loadCalendar(feedArg){!function(g){"use strict";function autolink(text){return text.replace(/((http|https|ftp):\/\/[\w?=&.\/-;#~%-]+(?![\w\s?&.\/;#~%"=-]*>))/g,"<a href='$1'>$1</a>")}function formatTime(date){var output=[];return output.push(date.getHours()%12||12),output.push(":"),output.push(("0"+date.getMinutes()).slice(-2)),output.push(date.getHours()>11?" p.m.":" a.m."),output.join("")}function sortEvents(a,b){return a.start<b.start?-1:a.start>b.start?1:0}function getNextEvent(events){for(var now=new Date,nevnt=0,i=events.length;i--;){var evnt=events[i],delta=evnt.start.getTime()-now.getTime();if(0>=delta)return nevnt=i,i}return nevnt}function displayEvents(data){for(var events=[],feed=(Date.now(),data.feed.getEntries()),i=feed.length;i--;)for(var evnt=feed[i],j=evnt.gd$when.length;j--;){var obj={};obj.title=evnt.getTitle().getText().replace("/","/<wbr>"),obj.content=autolink(evnt.getContent().getText()),obj.start=new Date(evnt.gd$when[j].startTime),obj.month=months[obj.start.getMonth()],obj.date=obj.start.getDate(),obj.day=days[obj.start.getDay()],obj.time=formatTime(obj.start);try{obj.address=evnt.gd$where[0].valueString.replace(", United States","")}catch(e){}events.unshift(obj)}events.sort(sortEvents);var nextEvent=getNextEvent(events)-2,templatedata={events:events};nextEvent>0&&(templatedata.events=events.slice(nextEvent)),cal.innerHTML=window.Mustache.render(tmpl,templatedata),body.classList.remove("loading")}function errorHandler(error){window.console.error(error)}function getEndOfMonth(start){var end=new Date(start.getTime());return end.setMonth(start.getMonth()+1),end=new Date(end-864e5),end.setHours(23),end.setMinutes(59),end.setSeconds(59),end.setMilliseconds(999),end}function init(){service=new g.gdata.calendar.CalendarService("notional-buffer-570");var start=new Date;start.setTime(start.getTime()-432e3),displayEventsFor(start)}function displayEventsFor(start,end){if(service&&start){end||(end=getEndOfMonth(start));var query=new g.gdata.calendar.CalendarEventQuery(feed);query.setMinimumStartTime(start.toISOString()),query.setMaximumStartTime(end.toISOString()),cal.innerHTML="",body.classList.add("loading"),currentStart=start,service.getEventsFeed(query,displayEvents,errorHandler)}}g.load("gdata","1");var service,currentStart,body=document.body,cal=document.getElementById("calendar"),feed=feedArg,days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months=["January","February","March","April","May","June","July","August","September","October","November","December"],tmpl=document.getElementById("template").innerHTML;g.setOnLoadCallback(init)}(window.google)}!function(){function domReady(){if(!isReady&&(isReady=!0,readyList)){for(var fn=0;fn<readyList.length;fn++)readyList[fn].call(window,[]);readyList=[]}}function addLoadEvent(func){var oldonload=window.onload;window.onload="function"!=typeof window.onload?func:function(){oldonload&&oldonload(),func()}}function bindReady(){if(!readyBound){if(readyBound=!0,document.addEventListener&&!browser.opera&&document.addEventListener("DOMContentLoaded",domReady,!1),browser.msie&&window==top&&function(){if(!isReady){try{document.documentElement.doScroll("left")}catch(error){return void setTimeout(arguments.callee,0)}domReady()}}(),browser.opera&&document.addEventListener("DOMContentLoaded",function(){if(!isReady){for(var i=0;i<document.styleSheets.length;i++)if(document.styleSheets[i].disabled)return void setTimeout(arguments.callee,0);domReady()}},!1),browser.safari){var numStyles;!function(){if(!isReady){if("loaded"!=document.readyState&&"complete"!=document.readyState)return void setTimeout(arguments.callee,0);if(void 0===numStyles){for(var links=document.getElementsByTagName("link"),i=0;i<links.length;i++)"stylesheet"==links[i].getAttribute("rel")&&numStyles++;var styles=document.getElementsByTagName("style");numStyles+=styles.length}return document.styleSheets.length!=numStyles?void setTimeout(arguments.callee,0):void domReady()}}()}addLoadEvent(domReady)}}var DomReady=window.DomReady={},userAgent=navigator.userAgent.toLowerCase(),browser={version:(userAgent.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(userAgent),opera:/opera/.test(userAgent),msie:/msie/.test(userAgent)&&!/opera/.test(userAgent),mozilla:/mozilla/.test(userAgent)&&!/(compatible|webkit)/.test(userAgent)},readyBound=!1,isReady=!1,readyList=[];DomReady.ready=function(fn){bindReady(),isReady?fn.call(window,[]):readyList.push(function(){return fn.call(window,[])})},bindReady()}(),function(root,factory){if("object"==typeof exports&&exports)factory(exports);else{var mustache={};factory(mustache),"function"==typeof define&&define.amd?define(mustache):root.Mustache=mustache}}(this,function(mustache){function testRegExp(re,string){return RegExp_test.call(re,string)}function isWhitespace(string){return!testRegExp(nonSpaceRe,string)}function isFunction(object){return"function"==typeof object}function escapeRegExp(string){return string.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function escapeHtml(string){return String(string).replace(/[&<>"'\/]/g,function(s){return entityMap[s]})}function escapeTags(tags){if(!isArray(tags)||2!==tags.length)throw new Error("Invalid tags: "+tags);return[new RegExp(escapeRegExp(tags[0])+"\\s*"),new RegExp("\\s*"+escapeRegExp(tags[1]))]}function parseTemplate(template,tags){function stripSpace(){if(hasTag&&!nonSpace)for(;spaces.length;)delete tokens[spaces.pop()];else spaces=[];hasTag=!1,nonSpace=!1}tags=tags||mustache.tags,template=template||"","string"==typeof tags&&(tags=tags.split(spaceRe));for(var start,type,value,chr,token,openSection,tagRes=escapeTags(tags),scanner=new Scanner(template),sections=[],tokens=[],spaces=[],hasTag=!1,nonSpace=!1;!scanner.eos();){if(start=scanner.pos,value=scanner.scanUntil(tagRes[0]))for(var i=0,len=value.length;len>i;++i)chr=value.charAt(i),isWhitespace(chr)?spaces.push(tokens.length):nonSpace=!0,tokens.push(["text",chr,start,start+1]),start+=1,"\n"===chr&&stripSpace();if(!scanner.scan(tagRes[0]))break;if(hasTag=!0,type=scanner.scan(tagRe)||"name",scanner.scan(whiteRe),"="===type?(value=scanner.scanUntil(equalsRe),scanner.scan(equalsRe),scanner.scanUntil(tagRes[1])):"{"===type?(value=scanner.scanUntil(new RegExp("\\s*"+escapeRegExp("}"+tags[1]))),scanner.scan(curlyRe),scanner.scanUntil(tagRes[1]),type="&"):value=scanner.scanUntil(tagRes[1]),!scanner.scan(tagRes[1]))throw new Error("Unclosed tag at "+scanner.pos);if(token=[type,value,start,scanner.pos],tokens.push(token),"#"===type||"^"===type)sections.push(token);else if("/"===type){if(openSection=sections.pop(),!openSection)throw new Error('Unopened section "'+value+'" at '+start);if(openSection[1]!==value)throw new Error('Unclosed section "'+openSection[1]+'" at '+start)}else"name"===type||"{"===type||"&"===type?nonSpace=!0:"="===type&&(tagRes=escapeTags(tags=value.split(spaceRe)))}if(openSection=sections.pop())throw new Error('Unclosed section "'+openSection[1]+'" at '+scanner.pos);return nestTokens(squashTokens(tokens))}function squashTokens(tokens){for(var token,lastToken,squashedTokens=[],i=0,len=tokens.length;len>i;++i)token=tokens[i],token&&("text"===token[0]&&lastToken&&"text"===lastToken[0]?(lastToken[1]+=token[1],lastToken[3]=token[3]):(squashedTokens.push(token),lastToken=token));return squashedTokens}function nestTokens(tokens){for(var token,section,nestedTokens=[],collector=nestedTokens,sections=[],i=0,len=tokens.length;len>i;++i)switch(token=tokens[i],token[0]){case"#":case"^":collector.push(token),sections.push(token),collector=token[4]=[];break;case"/":section=sections.pop(),section[5]=token[2],collector=sections.length>0?sections[sections.length-1][4]:nestedTokens;break;default:collector.push(token)}return nestedTokens}function Scanner(string){this.string=string,this.tail=string,this.pos=0}function Context(view,parentContext){this.view=null==view?{}:view,this.cache={".":this.view},this.parent=parentContext}function Writer(){this.cache={}}var RegExp_test=RegExp.prototype.test,nonSpaceRe=/\S/,Object_toString=Object.prototype.toString,isArray=Array.isArray||function(object){return"[object Array]"===Object_toString.call(object)},entityMap={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"},whiteRe=/\s*/,spaceRe=/\s+/,equalsRe=/\s*=/,curlyRe=/\s*\}/,tagRe=/#|\^|\/|>|\{|&|=|!/;Scanner.prototype.eos=function(){return""===this.tail},Scanner.prototype.scan=function(re){var match=this.tail.match(re);if(match&&0===match.index){var string=match[0];return this.tail=this.tail.substring(string.length),this.pos+=string.length,string}return""},Scanner.prototype.scanUntil=function(re){var match,index=this.tail.search(re);switch(index){case-1:match=this.tail,this.tail="";break;case 0:match="";break;default:match=this.tail.substring(0,index),this.tail=this.tail.substring(index)}return this.pos+=match.length,match},Context.prototype.push=function(view){return new Context(view,this)},Context.prototype.lookup=function(name){var value;if(name in this.cache)value=this.cache[name];else{for(var context=this;context;){if(name.indexOf(".")>0){value=context.view;for(var names=name.split("."),i=0;null!=value&&i<names.length;)value=value[names[i++]]}else value=context.view[name];if(null!=value)break;context=context.parent}this.cache[name]=value}return isFunction(value)&&(value=value.call(this.view)),value},Writer.prototype.clearCache=function(){this.cache={}},Writer.prototype.parse=function(template,tags){var cache=this.cache,tokens=cache[template];return null==tokens&&(tokens=cache[template]=parseTemplate(template,tags)),tokens},Writer.prototype.render=function(template,view,partials){var tokens=this.parse(template),context=view instanceof Context?view:new Context(view);return this.renderTokens(tokens,context,partials,template)},Writer.prototype.renderTokens=function(tokens,context,partials,originalTemplate){function subRender(template){return self.render(template,context,partials)}for(var token,value,buffer="",self=this,i=0,len=tokens.length;len>i;++i)switch(token=tokens[i],token[0]){case"#":if(value=context.lookup(token[1]),!value)continue;if(isArray(value))for(var j=0,jlen=value.length;jlen>j;++j)buffer+=this.renderTokens(token[4],context.push(value[j]),partials,originalTemplate);else if("object"==typeof value||"string"==typeof value)buffer+=this.renderTokens(token[4],context.push(value),partials,originalTemplate);else if(isFunction(value)){if("string"!=typeof originalTemplate)throw new Error("Cannot use higher-order sections without the original template");value=value.call(context.view,originalTemplate.slice(token[3],token[5]),subRender),null!=value&&(buffer+=value)}else buffer+=this.renderTokens(token[4],context,partials,originalTemplate);break;case"^":value=context.lookup(token[1]),(!value||isArray(value)&&0===value.length)&&(buffer+=this.renderTokens(token[4],context,partials,originalTemplate));break;case">":if(!partials)continue;value=isFunction(partials)?partials(token[1]):partials[token[1]],null!=value&&(buffer+=this.renderTokens(this.parse(value),context,partials,value));break;case"&":value=context.lookup(token[1]),null!=value&&(buffer+=value);break;case"name":value=context.lookup(token[1]),null!=value&&(buffer+=mustache.escape(value));break;case"text":buffer+=token[1]}return buffer},mustache.name="mustache.js",mustache.version="0.8.1",mustache.tags=["{{","}}"];var defaultWriter=new Writer;mustache.clearCache=function(){return defaultWriter.clearCache()},mustache.parse=function(template,tags){return defaultWriter.parse(template,tags)},mustache.render=function(template,view,partials){return defaultWriter.render(template,view,partials)},mustache.to_html=function(template,view,partials,send){var result=mustache.render(template,view,partials);return isFunction(send)?void send(result):result},mustache.escape=escapeHtml,mustache.Scanner=Scanner,mustache.Context=Context,mustache.Writer=Writer});